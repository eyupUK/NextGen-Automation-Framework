# Security Gate (SAST + Dependency + License)

This repo enforces a pre-test security gate to keep code clean and safe:

- SAST: SpotBugs + FindSecBugs on tests and support code
- Dependency scanning: OWASP Dependency-Check (fail on CVSS v3 ≥ 9.0)
- License: Third-party license inventory (THIRD-PARTY.txt/json)
- SBOM: CycloneDX BOM (target/bom.json)

## How it runs

- Locally (on demand):
  ```bash
  ./mvnw -Psecurity-gate -DskipTests=true verify
  ```
  Notes:
  - We disable DC auto-update by default in the POM for speed. Enable it explicitly when you want fresh data:
    ```bash
    ./mvnw -Psecurity-gate -Ddependency-check.autoUpdate=true -DskipTests=true verify
    ```

- In CI: `.github/workflows/ci.yml` runs the security-gate first, with Dependency-Check auto-update enabled and uploads reports.

Artifacts:
- SpotBugs: `target/spotbugs/*.xml` (and `.html` if generated by your IDE)
- Dependency-Check: `target/dependency-check-report/dependency-check-report.(html|json)`
- Licenses: `target/generated-sources/license/THIRD-PARTY.*`
- SBOM: `target/bom.json`

## Tuning thresholds

- Fail on CVEs with CVSS ≥ 9.0 (critical) by default. You can override temporarily:
  ```bash
  ./mvnw -Psecurity-gate -Dsecurity.failOnCvss=8.0 -DskipTests=true verify
  ```
  (In POM the profile binds a numeric constant for stability across Maven versions; prefer CLI overrides.)

## Optional: Strict CI profile (opt-in)

If you want extra discipline locally or in ad-hoc workflows, use:
```bash
./mvnw -Pci-strict validate
```
Rules:
- Maven ≥ 3.9
- No SNAPSHOT dependencies
- Project not built as a SNAPSHOT

This profile is not used by default in CI to avoid blocking demos.

## Troubleshooting

- If DC fails to fetch its NVD database behind a proxy, set standard proxy env vars or configure Maven settings.xml mirrors.
- If SpotBugs flags are too strict for a demo, you can run without the `security-gate` profile.
- Ensure you are on JDK 21; the build enforces this at `validate`.

